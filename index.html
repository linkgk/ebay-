<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>eBay利益計算機（フル機能）</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            background: #f8f9fa;
        }
        h1 {
            text-align: center;
            color: #333;
        }
        .container {
            max-width: 400px;
            margin: 0 auto;
            background: #fff;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 6px rgba(0,0,0,0.1);
        }
        label {
            display: block;
            margin: 10px 0 5px;
            font-weight: bold;
        }
        input, select {
            width: 100%;
            padding: 8px;
            margin-bottom: 10px;
            border: 1px solid #ccc;
            border-radius: 4px;
            font-size: 14px;
        }
        .result {
            background: #e9f7ef;
            padding: 15px;
            border-radius: 6px;
            font-size: 16px;
            font-weight: bold;
            color: #2e7d32;
            text-align: center;
            margin-top: 15px;
        }
        .note {
            font-size: 12px;
            text-align: center;
            margin-top: 10px;
            color: #777;
        }
    </style>
</head>
<body>
    <h1>eBay利益計算機</h1>
    <div class="container">
        <!-- カテゴリ選択 -->
        <label>カテゴリ選択</label>
        <select id="category">
            <option value="15">カメラ（15%）</option>
            <option value="12">ファッション（12%）</option>
            <option value="10">おもちゃ（10%）</option>
            <option value="14">家電（14%）</option>
            <option value="11">時計（11%）</option>
        </select>

        <!-- 自動反映される -->
        <label>eBay手数料率（%）</label>
        <input type="number" id="ebayFee" value="15">

        <label>販売価格（USD）</label>
        <input type="number" id="sellPrice" value="100">

        <label>仕入価格（JPY）</label>
        <input type="number" id="costPrice" value="8000">

        <label>為替レート（円/USD）</label>
        <input type="number" id="rate" value="150">

        <label>広告費率（%）</label>
        <input type="number" id="promoFee" value="2">

        <label>Payoneer手数料（%）</label>
        <input type="number" id="payoneerFee" value="2">

        <label>梱包資材費（円）</label>
        <input type="number" id="packingCost" value="50">

        <div class="result" id="profitResult">利益：0 円</div>
        <div class="result" id="profitRateResult">利益率：0 %</div>
        <div class="note">※為替レートはページ読み込み時に自動更新されます</div>
    </div>

    <script>
        const inputs = document.querySelectorAll("input");
        const categorySelect = document.getElementById("category");
        const profitResult = document.getElementById("profitResult");
        const profitRateResult = document.getElementById("profitRateResult");

        // カテゴリ選択時に手数料を反映
        categorySelect.addEventListener("change", function() {
            document.getElementById("ebayFee").value = this.value;
            calculateProfit();
        });

        // 利益計算
        function calculateProfit() {
            const sellPriceUSD = parseFloat(document.getElementById("sellPrice").value) || 0;
            const costJPY = parseFloat(document.getElementById("costPrice").value) || 0;
            const rate = parseFloat(document.getElementById("rate").value) || 1;
            const ebayFee = parseFloat(document.getElementById("ebayFee").value) || 0;
            const promoFee = parseFloat(document.getElementById("promoFee").value) || 0;
            const payoneerFee = parseFloat(document.getElementById("payoneerFee").value) || 0;
            const packingCost = parseFloat(document.getElementById("packingCost").value) || 0;

            // USD → JPY 換算
            const revenueJPY = sellPriceUSD * rate;

            // 手数料合計
            const totalFeeRate = (ebayFee + promoFee + payoneerFee) / 100;
            const feeAmount = revenueJPY * totalFeeRate;

            // 利益計算
            const profit = revenueJPY - feeAmount - costJPY - packingCost;
            const profitRate = revenueJPY > 0 ? (profit / revenueJPY) * 100 : 0;

            // 表示
            profitResult.textContent = `利益：${profit.toLocaleString()} 円`;
            profitRateResult.textContent = `利益率：${profitRate.toFixed(2)} %`;
        }

        // 為替APIから最新レート取得
        async function fetchExchangeRate() {
            try {
                const response = await fetch("https://api.exchangerate-api.com/v4/latest/USD");
                const data = await response.json();
                const usdToJpy = data.rates.JPY; // USD→JPY
                document.getElementById("rate").value = usdToJpy.toFixed(2);
                calculateProfit();
            } catch (error) {
                console.error("為替レート取得エラー", error);
            }
        }

        // 入力変更時に再計算
        inputs.forEach(input => input.addEventListener("input", calculateProfit));

        // 初期処理
        fetchExchangeRate();
        calculateProfit();
    </script>
</body>
</html>
